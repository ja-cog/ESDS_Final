---
title: "Final"
author: "Jacob Coggshall"
date: "2023-06-13"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r}
library(here)  # (here package: RStudio Team, 2021)
library(dplyr)  # (Wickham et al., 2021)
library(janitor)  # (Firke, 2021)
library(ggplot2)  # (Wickham, 2016)
library(tidyverse)  # (Wickham et al., 2019)
library(naniar)  # (Tierney et al., 2021)
library(skimr)  # (Carter, 2020)
library(GGally)  # (Schloerke et al., 2020)
library(flextable)  # (Gohel, 2021)
library(car)  # (Fox et al., 2020)
```

```{r}
bank <- read_csv(here("data", "sev208_kratseedbank_20120213.csv")) |>
  clean_names() |>
  mutate(seed_count = seeds,
         mound = mnd,
         direction = dir,
         location = loc) |>
  select(-seeds, -mnd, -dir, -loc) |>
  filter(seed_count != 0)
```

```{r}
gg_miss_var(bank)  # (Tierney et al., 2021)
```

Null Hypothesis (H0): There is no difference in the total seed number between kangaroo rat mound locations.

Alternative Hypothesis (HA): There is a difference in the total seed number between kangaroo rat mound locations.


```{r}
#Creating a model object
model <- aov(seed_count ~ location, data = bank) # (R Core Team, 2021)
```

```{r}
# Set the theme
theme_set(theme_minimal()) # (Wickham, 2016)

# Create the histogram
ggplot(data = bank, aes(x = seed_count)) +
  geom_histogram(bins = 6, fill = "steelblue", color = "black") +
  labs(x = "Seed Count", y = "Frequency", title = "Seed Count Histogram") +
  theme(plot.title = element_text(size = 16, face = "bold"),
        axis.title = element_text(size = 12),
        axis.text = element_text(size = 10),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank())
```

Histogram to check distribution

```{r}
# Perform Levene's test
levene_test <- car::leveneTest(seed_count ~ location, data = bank) # (Fox et al., 2020)

# Print the test statistic and p-value
print(levene_test)
```

Levene's test is a test for homogeneity of variances, which checks if the variances of the seed_count variable are equal across the location groups. The test statistic (F-value) is 12.414, and the associated p-value is very small (less than 0.001). This suggests that there is strong evidence to reject the null hypothesis, indicating that the variances of seed_count are significantly different across the location groups.



```{r}
summary(model) # (R Core Team, 2021)
```

```{r}
#Running Kruskal Wallis rank sum test
kruskal.test(seed_count ~ location, data = bank) # (R Core Team, 2021)
```
```{r}
ggplot(data = bank, aes(x = location, y = seed_count)) +
  geom_jitter(trim = FALSE) +
  labs(x = "Mound Location", y = "Total Seed Number") +
  ggtitle("Distribution of Total Seed Number by Mound Location") +
  theme(plot.title = element_text(size = 14, face = "bold"),
        axis.text = element_text(size = 12),
        axis.title = element_text(size = 12),
        plot.background = element_rect(fill = "white"),
        panel.background = element_rect(fill = "white"),
        panel.grid.major = element_line(color = "gray", linetype = "dashed"))
```

"Distribution of Total Seed Number by Mound Location: The plot illustrates the variation in total seed numbers for different mound locations. Each point represents a data point, with the vertical position indicating the seed count value. Jittering is applied to prevent overlapping points. The x-axis represents the mound locations: B (base of kangaroo rat mound on the mound), D (surrounding area of kangaroo rat mound on the mound), E (edge of Bouteloua eripoda grass clumps off the mound), and I (interspace between black grama grass clumps off the mound). The y-axis represents the total seed number."

Conclusion:

The Kruskal-Wallis test was chosen as the best statistical test to evaluate the differences in total seed number between kangaroo rat mound locations. This choice was made due to the non-normal distribution of the data and the violation of assumptions required for parametric tests like ANOVA.

After conducting the Kruskal-Wallis test, we obtained a test statistic of 22.852 with a corresponding p-value of 4.335e-05. Since the p-value is less than the significance level of 0.05, we reject the null hypothesis. Therefore, we have sufficient evidence to conclude that there is a significant difference in the distribution of seed count between kangaroo rat mound locations.



```{r}
community <- read_csv(here("data", "shrubstudy_community_flower_counts.ms.data.csv")) |>
  clean_names() 
  
  individual <- read_csv(here("data", "shrubstudy_individual_flower_counts.ms.data.csv")) |>
  clean_names() 
  
    observers <- read_csv(here("data", "shrubstudy_pollinator.ms.data.csv")) |>
  clean_names() 
  
  count <- read_csv(here("data", "shrubstudy_seed_ctwt.ms.data.csv")) |>
  clean_names() 


filtered_count <- count %>%
  dplyr::select(treatment, species, total_nr_infl, nr_seeds)|> 
 na.omit()%>%
  filter(rowSums(. != 0, na.rm = TRUE) > 0) %>%
  mutate(treatment = ifelse(treatment == "control", "open", treatment)) 
  


  
```

```{r}
gg_miss_var(filtered_count) # (Tierney et al., 2021)
```

Hypothesises

Null Hypotheses:

Plot Type: There is no significant difference in seed count between shrub and open plots.

Plant Species: There is no significant difference in seed count among different plant species.

Total Number of Inflorescences: There is no significant relationship between the total number of inflorescences and seed count.

Alternative Hypotheses:

Plot Type: There is a significant difference in seed count between shrub and open plots.

Plant Species: There is a significant difference in seed count among different plant species.

Total Number of Inflorescences: There is a significant relationship between the total number of Inflorescences and seed count.

```{r}
# Histogram for Total_nr_infl
ggplot(data = count, aes(x = total_nr_infl)) +
  geom_histogram(fill = "blue", color = "black", bins = 20) +
  labs(x = "Total Number of Inflorescences", y = "Frequency") +
  ggtitle("Histogram of Total Number of Inflorescences")

# Histogram for Nr_seeds
ggplot(data = count, aes(x = nr_seeds)) +
  geom_histogram(fill = "red", color = "black", bins = 20) +
  labs(x = "Seed Count", y = "Frequency") +
  ggtitle("Histogram of Seed Count")
```
Checking Normality

```{r}
# Levene's test for Total_nr_infl
levene_test_total_nr_infl <- car::leveneTest(total_nr_infl ~ treatment, data = filtered_count)  # (Fox et al., 2020)
print(levene_test_total_nr_infl)

# Levene's test for Nr_seeds
levene_test_nr_seeds <- car::leveneTest(nr_seeds ~ treatment, data = filtered_count)
print(levene_test_nr_seeds)
```
Testing Homogeneity of Variance

```{r}
lm_model <- lm(nr_seeds ~ treatment + species + total_nr_infl, data = filtered_count)

# Print the summary of the regression model
summary(lm_model)
```

Interpretation of the coefficients:

Intercept: The estimated intercept represents the expected seed count when all other variables are zero. In this case, it is -2.56735, but the p-value (0.36768) suggests that it is not statistically significant.

treatmentshrub: This coefficient represents the difference in seed count between the shrub treatment and the open plot treatment. The estimated effect is -2.91198, but the p-value (0.09724) suggests that it is marginally significant.

speciesCARRUP, speciesGEUROS, speciesKOBMYO, speciesMINOBT, and speciesTRIDAS: These coefficients represent the differences in seed count among different plant species compared to the reference species (which is not specified in the output). The estimated effects vary for each species, but none of them are statistically significant based on the given p-values (all p-values > 0.05, except for speciesGEUROS with p-value = 0.02891).

total_nr_infl: This coefficient represents the expected change in seed count for each unit increase in the total number of inflorescences. The estimated effect is 2.15013, and the p-value is highly significant (< 2.2e-16), indicating a strong association between total number of inflorescences and seed count.

Overall, the multiple linear regression model suggests that the total number of inflorescences is a significant predictor of seed count. The other variables, including plot type and plant species, do not show significant associations with seed count in this analysis.

```{r}

# Scatterplot of seed count and total number of inflorescences
ggplot(filtered_count, aes(x = total_nr_infl, y = nr_seeds, color = treatment)) +
  geom_point() +
  facet_wrap(~species) +
  labs(x = "Total Number of Inflorescences", y = "Seed Count") +
  theme_minimal()

```
Caption: Scatterplot showing the relationship between seed count (nr_seeds) and the total number of inflorescences (total_nr_infl). Each point represents a data point, color-coded by plot type (treatment). The data is further divided into facets based on plant species.
```{r}
# Residual plot
residuals <- residuals(lm_model)
predicted <- fitted(lm_model)

plot(predicted, residuals, main = "Residual Plot", xlab = "Predicted Values", ylab = "Residuals")
abline(h = 0, lty = 2, col = "red")

```
Caption: Residual plot depicting the residuals of the multiple linear regression model. The x-axis represents the predicted values of seed count (nr_seeds), while the y-axis displays the corresponding residuals. The red dashed line indicates the ideal scenario of zero residuals.
```{r}

# Partial regression plot for total number of inflorescences
crPlots(lm_model, terms = "total_nr_infl", main = "Partial Regression Plot: Total Number of Inflorescences",
        xlab = "Total Number of Inflorescences", ylab = "Partial Effect on Seed Count")


```
Caption: Partial regression plot illustrating the relationship between seed count (nr_seeds) and the total number of inflorescences (total_nr_infl) while controlling for other variables. The plot provides an estimation of the effect of the total number of inflorescences on seed count, accounting for the influence of other independent variables.

```{r}
# Overall model fit plot
predicted <- fitted(lm_model)
observed <- filtered_count$nr_seeds

plot(predicted, observed, main = "Model Fit: Predicted vs. Observed", xlab = "Predicted Values", ylab = "Observed Values")
abline(0, 1, col = "red", lty = 2)

```
Caption: Plot comparing the observed seed count (nr_seeds) to the predicted values from the multiple linear regression model. The diagonal red dashed line represents perfect alignment between the observed and predicted values, indicating a good fit of the model to the data.

Conclusion

Choice of Multiple Linear Regression Test: The multiple linear regression test was the best choice for analyzing the relationship between seed count and the predictor variables (plot type, plant species, and total number of inflorescences) in our dataset. This test allowed us to examine the simultaneous effects of multiple variables on seed count and assess their significance.

Conclusion on the Relationship between Variables and Seed Count:

Plot Type: There is a marginally significant difference in seed count between shrub and open plots, as indicated by the coefficient estimate and p-value associated with the "treatmentshrub" variable.
Plant Species: There is no significant difference in seed count among different plant species, based on the coefficients and p-values associated with the plant species variables.
Total Number of Inflorescences: There is a highly significant positive relationship between the total number of inflorescences and seed count, as supported by the coefficient estimate and the extremely low p-value.

Overall, the multiple linear regression model revealed that the total number of inflorescences had a significant positive impact on seed count, while other variables did not show significant relationships. This finding suggests that the abundance of inflorescences plays a crucial role in determining the seed count.